<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRAVELOVER ADMIN</title>
  <link rel="stylesheet" href="./resources/css/base.css">
</head>

<body class="worklist">
  <div class="wrap-guide">
    <header class="guide-head">
      <h1 class="guide-title"><a href="#none"><strong>TraveLover Admin</strong></a></h1>
      <div class="legend">
        <ul class="legend-list">
          <li class="state_new"><button type="button" onclick="filterState('new')">NEW</button></li>
          <li class="state_ing"><button type="button" onclick="filterState('ing')">진행</button></li>
          <li class="state_edit"><button type="button" onclick="filterState('edit')">수정</button></li>
          <li class="state_del"><button type="button" onclick="filterState('del')">삭제</button></li>
        </ul>
      </div>
    </header>
    <main class="guide-main">
      <div id="guide-list" class="guide-list">
        <table class="tbl-base">
          <thead id="table-head"></thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </main>
  </div>

  <script>
    const config = { siteName: 'TraveLover Admin' };
    const tHead = {
      no: 1,
      dep1: 1,
      dep2: 1,
      dep3: 1,
      dep4: 1,
      dep5: 1,
      dep6: 1,
      url: 1,
      role: 0,
      date: 1,
      etc: 1,
    };
    let tBody = [];
    let filter = '';

    document.addEventListener('DOMContentLoaded', () => {
      fetchData();
    });

    function fetchData() {
      fetch('./resources/file/pathlist.json?' + new Date().getTime()) // 경로 설정
        .then(response => response.json())
        .then(data => {
          tBody = data;
          renderTable();
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    function renderTable() {
      const tblHead = document.getElementById('table-head');
      const tblBody = document.getElementById('table-body');

      // 테이블 헤더 생성
      tblHead.innerHTML = '';
      const headerRow = document.createElement('tr');
      for (const key in tHead) {
        if (tHead[key]) {
          const th = document.createElement('th');
          th.className = 'col-' + key;
          th.textContent = key.toLowerCase();
          headerRow.appendChild(th);
        }
      }
      tblHead.appendChild(headerRow);

      // 테이블 본문 생성
      tblBody.innerHTML = '';
      const filteredList = tBody.filter(item => !filter || item.stateLine === filter);
      filteredList.forEach((item, index) => {
        const row = document.createElement('tr');
        row.className = item.stateLine ? 'state-' + item.stateLine : '';

        for (const key in tHead) {
          if (tHead[key]) {
            const td = document.createElement('td');
            td.className = 'col-' + key;

            if (key === 'no') {
              td.textContent = index + 1;
            } else if (key === 'url' && item[key]) {
              const a = document.createElement('a');
              a.href = item[key];
              a.target = '_blank';
              a.textContent = getFileName(item[key]);
              td.appendChild(a);
            } else {
              td.textContent = item[key] || '';
            }
            row.appendChild(td);
          }
        }
        tblBody.appendChild(row);
      });
    }

    function filterState(state) {
      filter = state;
      renderTable();
    }

    function getFileName(url) {
      const parts = url.split('/');
      return parts[parts.length - 1];
    }
  </script>
</body>

</html>